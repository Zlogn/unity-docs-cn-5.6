<!DOCTYPE html><html class="no-js" lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-5V25JL6');
    </script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="twitter:card" content="summary">
<meta name="robots" content="noindex">
<meta property="og:title" content="计算着色器 - Unity 手册">
<title>计算着色器 - Unity 手册</title>
<meta name="description" content="Compute shaders are programs that run on the graphics card, outside of the normal rendering pipeline. They can be used for massively parallel GPGPU algorithms, or to accelerate parts of game rendering. In order to efficiently use them, an in-depth knowledge of GPU architectures and parallel algorithms is often needed; as well as knowledge of DirectCompute,
OpenGL Compute,
OpenCL, CUDA, or OpenCL.">
<meta property="og:description" content="Compute shaders are programs that run on the graphics card, outside of the normal rendering pipeline. They can be used for massively parallel GPGPU algorithms, or to accelerate parts of game rendering. In order to efficiently use them, an in-depth knowledge of GPU architectures and parallel algorithms is often needed; as well as knowledge of DirectCompute,
OpenGL Compute,
OpenCL, CUDA, or OpenCL.">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="../StaticFiles/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFiles/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png">
<script>
      var docs_type = 'Manual';
      var lang = 'cn';
      var page = 'ComputeShaders';
      if(!page) page = 'index';
      var version = '560';
      var docs_versions = [{version: '2020.1',version_string: '2020.1'},{version: '2019.3',version_string: '2019.3'},{version: '2019.2',version_string: '2019.2'},{version: '2019.1',version_string: '2019.1'},{version: '2018.4',version_string: '2018.4'},{version: '2018.3',version_string: '2018.3'},{version: '2018.2',version_string: '2018.2'},{version: '2018.1',version_string: '2018.1'},{version: '2017.4',version_string: '2017.4'},{version: '2017.3',version_string: '2017.3'},{version: '2017.2',version_string: '2017.2'},{version: '2017.1',version_string: '2017.1'},{version: '5.6',version_string: '560'},];</script><script type="text/javascript" src="../StaticFiles/js/jquery.js"></script><script type="text/javascript" src="../StaticFiles/js/core.js"></script><script type="text/javascript" src="../StaticFiles/js/jquery.sidebar.min.js"></script><script type="text/javascript" src="docdata/toc.js"></script><script type="text/javascript" src=""></script><script type="text/javascript" src="../StaticFiles/js/custom.js"></script><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,400italic" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/custom.css">
<link rel="canonical" href="https://docs.unity3d.com/cn/560/Manual/ComputeShaders.html">
<link rel="alternate" href="https://docs.unity3d.com/en/560/Manual/ComputeShaders.html" hreflang="en">
<link rel="alternate" href="https://docs.unity3d.com/ja/560/Manual/ComputeShaders.html" hreflang="ja">
<link rel="alternate" href="https://docs.unity3d.com/es/560/Manual/ComputeShaders.html" hreflang="es">
<link rel="alternate" href="https://docs.unity3d.com/kr/560/Manual/ComputeShaders.html" hreflang="ko">
<link rel="alternate" href="https://docs.unity3d.com/ru/560/Manual/ComputeShaders.html" hreflang="ru">
<link rel="alternate" href="https://docs.unity3d.com/560/Documentation/Manual/ComputeShaders.html" hreflang="x-default">
</head>
<body>
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="http://docs.unity3d.com"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="搜索手册..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul class="menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity3d.com/">
                unity3d.com
              </a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>5.6</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;"><ul>
<li><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/ComputeShaders.html">2020.1</a></li>
<li><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/ComputeShaders.html">2019.3</a></li>
<li><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/ComputeShaders.html">2019.2</a></li>
<li><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/ComputeShaders.html">2019.1</a></li>
<li><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/ComputeShaders.html">2018.4</a></li>
<li><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/ComputeShaders.html">2018.3</a></li>
<li><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/ComputeShaders.html">2018.2</a></li>
<li><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/ComputeShaders.html">2018.1</a></li>
<li><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/ComputeShaders.html">2017.4</a></li>
<li><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/ComputeShaders.html">2017.3</a></li>
<li><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/ComputeShaders.html">2017.2</a></li>
<li><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/ComputeShaders.html">2017.1</a></li>
<li><a class="docs_version_url_560" href="/cn/560/Manual/ComputeShaders.html">5.6</a></li>
</ul></div>
</div>
<ul class="nav-menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">语言:
        <span class="b">中文</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a data-lang="en" href="/560/Documentation/Manual/ComputeShaders.html">English</a></li>
<li><a data-lang="ja" href="/ja/560/Manual/ComputeShaders.html">日本語</a></li>
<li><a data-lang="es" href="/es/560/Manual/ComputeShaders.html">Español</a></li>
<li><a data-lang="kr" href="/kr/560/Manual/ComputeShaders.html">한국어</a></li>
<li><a data-lang="ru" href="/ru/560/Manual/ComputeShaders.html">Русский</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar hidden"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc">
<h2>手册</h2>
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>5.6</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;"><ul>
<li><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/ComputeShaders.html">2020.1</a></li>
<li><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/ComputeShaders.html">2019.3</a></li>
<li><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/ComputeShaders.html">2019.2</a></li>
<li><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/ComputeShaders.html">2019.1</a></li>
<li><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/ComputeShaders.html">2018.4</a></li>
<li><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/ComputeShaders.html">2018.3</a></li>
<li><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/ComputeShaders.html">2018.2</a></li>
<li><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/ComputeShaders.html">2018.1</a></li>
<li><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/ComputeShaders.html">2017.4</a></li>
<li><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/ComputeShaders.html">2017.3</a></li>
<li><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/ComputeShaders.html">2017.2</a></li>
<li><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/ComputeShaders.html">2017.1</a></li>
<li><a class="docs_version_url_560" href="/cn/560/Manual/ComputeShaders.html">5.6</a></li>
</ul></div>
</div>
<div class="clear"></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap opened-sidebar"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity User Manual (5.6)</a></li>
<li><a href="Graphics.html">图形</a></li>
<li><a href="GraphicsOverview.html">图形概述</a></li>
<li>高级渲染功能</li>
<li>计算着色器</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="OpenGLCoreDetails.html"></a></span><div class="tip">OpenGL Core 详细信息</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="GraphicsCommandBuffers.html"></a></span><div class="tip">图形命令缓冲区</div>
</div>
</div></div>
<h1>计算着色器</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>Compute shaders are programs that run on the graphics card, outside of the normal rendering pipeline. They can be used for massively parallel GPGPU algorithms, or to accelerate parts of game rendering. In order to efficiently use them, an in-depth knowledge of GPU architectures and parallel algorithms is often needed; as well as knowledge of <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ff476331.aspx">DirectCompute</a>,
<a href="https://www.khronos.org/opengl/wiki/Compute_Shader">OpenGL Compute</a>,
<a href="http://en.wikipedia.org/wiki/OpenCL">OpenCL</a>, <a href="http://en.wikipedia.org/wiki/CUDA">CUDA</a>, or <a href="http://en.wikipedia.org/wiki/OpenCL">OpenCL</a>.</p>

<p>Unity 中的计算着色器与 <a href="https://en.wikipedia.org/wiki/DirectX">DirectX</a> 11 DirectCompute 技术紧密配合。计算着色器适用的平台：</p>

<ul>
<li><p>Windows 和 Windows 应用商店，使用 DirectX 11 或 DirectX 12 图形 API 和 Shader Model 5.0 GPU</p></li>
<li><p>macOS 和 iOS，使用 <a href="https://developer.apple.com/metal/">Metal 图形</a> API</p></li>
<li><p>Android、Linux 和 Windows 平台，<a href="https://www.khronos.org/vulkan/">Vulkan</a> API</p></li>
<li><p>现代 <a href="https://www.opengl.org/">OpenGL</a> 平台（Linux 或 Windows 上的 OpenGL 4.3；Android 上的 OpenGL ES 3.1）。请注意，Mac OS X 不支持 OpenGL 4.3</p></li>
<li><p>现代游戏主机（Sony PS4 和 Microsoft Xbox One）</p></li>
</ul>

<p>在运行时可使用 <a href="../ScriptReference/SystemInfo-supportsComputeShaders.html">SystemInfo.supportsComputeShaders</a> 来查询计算着色器支持情况。</p>

<h2>计算着色器资源</h2>

<p>类似于<a href="class-Shader.html">常规着色器</a>，计算着色器是项目中的资源文件，文件扩展名为 <em>.compute</em>。它们是以 DirectX 11 样式 <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb509561.aspx">HLSL</a> 语言编写的，具有最少数量的 #pragma 编译指令来指示哪些函数将编译为计算着色器内核。</p>

<p>下面是计算着色器文件的基本示例，它使用红色填充输出纹理：</p>

<pre><code>// test.compute

# pragma kernel FillWithRed

RWTexture2D&lt;float4&gt; res;

[numthreads(1,1,1)]
void FillWithRed (uint3 dtid : SV_DispatchThreadID)
{
    res[dtid.xy] = float4(1,0,0,1);
}
</code></pre>

<p>The language is standard DX11 HLSL, with the only exception of a <code>#pragma kernel FillWithRed</code> directive. One compute shader Asset file must contain at least one<code>compute kernel</code> that can be invoked, and that function is indicated by the <code>#pragma directive</code>. There can be more kernels in the file; just add multiple <code>#pragma kernel</code> lines.</p>

<p>使用多个 <code>#pragma kernel</code> 行时，请注意在 <code>#pragma kernel</code> 指令的同一行上不允许 <code>// text</code> 样式的注释，如果使用，会导致编译错误。</p>

<p>可选择性地在 <code>#pragma kernel</code> 行后面添加要在编译该内核时定义的多个预处理器宏，例如：</p>

<pre><code># pragma kernel KernelOne SOME_DEFINE DEFINE_WITH_VALUE=1337
# pragma kernel KernelTwo OTHER_DEFINE
// ...
</code></pre>

<h2>调用计算着色器</h2>

<p>在脚本中，应定义 ComputeShader 类型的变量并分配对资源的引用。如此便可使用 <a href="../ScriptReference/ComputeShader.Dispatch.html">ComputeShader.Dispatch</a> 函数来调用它们。请参阅关于 <a href="../ScriptReference/ComputeShader.html">ComputeShader 类</a>的 Unity 文档以了解更多详细信息。</p>

<p>Closely related to compute shaders is a <a href="../ScriptReference/ComputeBuffer.html">ComputeBuffer</a> class, which defines arbitrary data buffer (“structured buffer” in DX11 lingo). {Render Textures](../ScriptReference/RenderTexture.html) can also be written into from compute shaders, if they have “random access” flag set (“unordered access view” in DX11). See <a href="../ScriptReference/RenderTexture-enableRandomWrite.html">RenderTexture.enableRandomWrite</a> to learn more about this.</p>

<h2>计算着色器中的纹理采样器</h2>

<p>纹理和采样器不是 Unity 中的单独对象，因此要在计算着色器中使用它们，必须遵循以下 Unity 特定规则之一：</p>

<ul>
<li><p>使用与纹理名称相同的名称，以 <code>sampler</code> 开头（例如，<code>Texture2D MyTex</code>；<code>SamplerState samplerMyTex</code>）。在此情况下，采样器将初始化为纹理的过滤/包裹/各向异性 (filter/wrap/aniso) 设置。</p></li>
<li><p>使用预定义采样器。因此，该名称必须具有 <code>Linear</code> 或 <code>Point</code>（对于过滤模式）和 <code>Clamp</code> 或 <code>Repeat</code>（包裹模式）。例如，<code>SamplerState MyLinearClampSampler</code> 会创建一个具有线性过滤模式和钳制包裹模式的采样器。</p></li>
</ul>

<h2>跨平台支持</h2>

<p>与常规着色器一样，Unity 可将计算着色器从 HLSL <a href="SL-ShadingLanguage.html">转换</a>为其他着色器语言。因此，对于最简单的跨平台版本，应以 HLSL 编写计算着色器。但是，在执行此操作时需要考虑一些因素。</p>

<h3>跨平台最佳实践</h3>

<p>DirectX 11 (DX11) 支持在其他平台（如 <a href="https://developer.apple.com/metal/">Metal</a> 或 <a href="https://www.opengl.org/">OpenGL ES</a>）上不支持的许多操作。因此，应始终确保着色器在提供更少支持的平台（而不是仅在 DX11 上）上具有良好定义的行为。以下是要考虑的一些事项：</p>

<ul>
<li><p>越界内存访问是错误的。DX11 在读取时可能始终返回零，并且在读取某些写入时没有问题，但提供较少支持的平台可能会在执行此操作时导致 GPU 崩溃。密切注意特定于 DX11 的破解问题，与线程组大小倍数不匹配的缓冲区大小，试图从缓冲区的开头或结尾读取相邻的数据元素，以及类似的不兼容性。</p></li>
<li><p>初始化您的资源。新缓冲区和纹理的内容是未定义的。有些平台可能会提供全零，但在其他平台上，可能会有某种内容（包括非数字）。</p></li>
<li><p>绑定计算着色器声明的所有资源。即使您确定着色器在当前状态下由于分支而没有使用资源，仍必须确保有资源与其绑定。</p></li>
</ul>

<h3>平台特定差异</h3>

<ul>
<li><p><a href="https://www.opengl.org/">Metal</a> (for iOS and tvOS platforms) does not support atomic operations on Textures. Metal also does not support <code>GetDimensions</code> queries on buffers. Pass the buffer size info as constant to the shader if needed.</p></li>
<li><p><a href="https://www.opengl.org/">OpenGL ES</a> 3.1 (for (Android, iOS, tvOS, Tizen platforms) only guarantees support for 4 compute buffers at a time. Actual implementations typically support more, but in general if developing for OpenGL ES, you should consider grouping related data in structs rather than having each data item in its own buffer.</p></li>
</ul>

<h2>仅限 HLSL 或仅限 GLSL 的计算着色器</h2>

<p>通常情况下会以 <a href="https://en.wikipedia.org/wiki/High-Level_Shading_Language">HLSL</a> 编写计算着色器文件，并自动将这些文件编译或转换到所有需要的平台中。但是，可以阻止转换为其他语言（即仅保留 HLSL 平台）或者手动编写 <a href="https://en.wikipedia.org/wiki/OpenGL_Shading_Language">GLSL</a> 计算代码。</p>

<p>以下信息仅适用于仅限 HLSL 或仅限 GLSL 的计算着色器，而不适用于跨平台版本。这是因为此信息可能导致计算着色器源代码被排除在某些平台之外。</p>

<ul>
<li><p>对于非 HLSL 平台，不会处理 <code>CGPROGRAM</code> 和 <code>ENDCG</code> 关键字包围的计算着色器源代码。</p></li>
<li><p><code>GLSLPROGRAM</code> 和 <code>ENDGLSL</code> 关键字包围的计算着色器源代码视为 GLSL 源代码，并逐字发出。这仅在目标平台为 OpenGL 或 GLSL 平台时才奏效。还应注意，虽然自动转换的着色器遵循缓冲区上的 HLSL 数据布局，但是手动编写的 GLSL 着色器将遵循 GLSL 布局规则。</p></li>
</ul>

<p><br> </p>

<ul>
<li><p><span class="page-edit"> 2017–05–18 Page amended with limited <a href="DocumentationEditorialReview.html">editorial review</a> - <a href="LeaveFeedback.html">Leave page feedback</a></span></p></li>
<li><p><span class="page-history">在 5.6 版中添加：SystemInfo.supportsComputeShaders、平台 macOS、iOS（使用 Metal）、Android、Linux、Windows（具有 Vulkan）
</span></p></li>
</ul>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="OpenGLCoreDetails.html"></a></span><div class="tip">OpenGL Core 详细信息</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="GraphicsCommandBuffers.html"></a></span><div class="tip">图形命令缓冲区</div>
</div>
</div>
</div>
<div class="footer-wrapper">
<div class="footer clear">
<div class="copy">Copyright © 2017 Unity Technologies. Publication 5.6</div>
<div class="menu">
<a href="http://unity3d.com/learn">教程</a><a href="http://answers.unity3d.com">社区答案</a><a href="https://support.unity3d.com/hc/en-us">知识库</a><a href="http://forum.unity3d.com">论坛</a><a href="http://unity3d.com/asset-store">Asset Store</a>
</div>
</div>
<div></div>
</div>
</div></div></div>
</div>
</body>
</html>
