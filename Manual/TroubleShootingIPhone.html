<!DOCTYPE html><html class="no-js" lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-5V25JL6');
    </script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="twitter:card" content="summary">
<meta name="robots" content="noindex">
<meta property="og:title" content="在 iOS 设备上进行故障排除 - Unity 手册">
<title>在 iOS 设备上进行故障排除 - Unity 手册</title>
<meta property="og:image" content="https://docs.unity3d.com/cn/5.6/uploads/Main/ActivityMonitor.png">
<meta name="description" content="在 iOS 中，有些情况下，游戏可以在 Unity Editor 中完美运行，但在实际设备上却无法运行，甚至无法启动。
这些问题通常与代码或内容质量有关。本部分将介绍最常见的情况。">
<meta property="og:description" content="在 iOS 中，有些情况下，游戏可以在 Unity Editor 中完美运行，但在实际设备上却无法运行，甚至无法启动。
这些问题通常与代码或内容质量有关。本部分将介绍最常见的情况。">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="../StaticFiles/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFiles/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png">
<script>
      var docs_type = 'Manual';
      var lang = 'cn';
      var page = 'TroubleShootingIPhone';
      if(!page) page = 'index';
      var version = '560';
      var docs_versions = [{version: '2020.1',version_string: '2020.1'},{version: '2019.3',version_string: '2019.3'},{version: '2019.2',version_string: '2019.2'},{version: '2019.1',version_string: '2019.1'},{version: '2018.4',version_string: '2018.4'},{version: '2018.3',version_string: '2018.3'},{version: '2018.2',version_string: '2018.2'},{version: '2018.1',version_string: '2018.1'},{version: '2017.4',version_string: '2017.4'},{version: '2017.3',version_string: '2017.3'},{version: '2017.2',version_string: '2017.2'},{version: '2017.1',version_string: '2017.1'},{version: '5.6',version_string: '560'},];</script><script type="text/javascript" src="../StaticFiles/js/jquery.js"></script><script type="text/javascript" src="../StaticFiles/js/core.js"></script><script type="text/javascript" src="../StaticFiles/js/jquery.sidebar.min.js"></script><script type="text/javascript" src="docdata/toc.js"></script><script type="text/javascript" src=""></script><script type="text/javascript" src="../StaticFiles/js/custom.js"></script><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,400italic" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/custom.css">
<link rel="canonical" href="https://docs.unity3d.com/cn/560/Manual/TroubleShootingIPhone.html">
<link rel="alternate" href="https://docs.unity3d.com/en/560/Manual/TroubleShootingIPhone.html" hreflang="en">
<link rel="alternate" href="https://docs.unity3d.com/ja/560/Manual/TroubleShootingIPhone.html" hreflang="ja">
<link rel="alternate" href="https://docs.unity3d.com/es/560/Manual/TroubleShootingIPhone.html" hreflang="es">
<link rel="alternate" href="https://docs.unity3d.com/kr/560/Manual/TroubleShootingIPhone.html" hreflang="ko">
<link rel="alternate" href="https://docs.unity3d.com/ru/560/Manual/TroubleShootingIPhone.html" hreflang="ru">
<link rel="alternate" href="https://docs.unity3d.com/560/Documentation/Manual/TroubleShootingIPhone.html" hreflang="x-default">
</head>
<body>
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="http://docs.unity3d.com"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="搜索手册..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul class="menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity3d.com/">
                unity3d.com
              </a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>5.6</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;"><ul>
<li><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/TroubleShootingIPhone.html">2020.1</a></li>
<li><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/TroubleShootingIPhone.html">2019.3</a></li>
<li><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/TroubleShootingIPhone.html">2019.2</a></li>
<li><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/TroubleShootingIPhone.html">2019.1</a></li>
<li><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/TroubleShootingIPhone.html">2018.4</a></li>
<li><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/TroubleShootingIPhone.html">2018.3</a></li>
<li><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/TroubleShootingIPhone.html">2018.2</a></li>
<li><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/TroubleShootingIPhone.html">2018.1</a></li>
<li><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/TroubleShootingIPhone.html">2017.4</a></li>
<li><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/TroubleShootingIPhone.html">2017.3</a></li>
<li><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/TroubleShootingIPhone.html">2017.2</a></li>
<li><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/TroubleShootingIPhone.html">2017.1</a></li>
<li><a class="docs_version_url_560" href="/cn/560/Manual/TroubleShootingIPhone.html">5.6</a></li>
</ul></div>
</div>
<ul class="nav-menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">语言:
        <span class="b">中文</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a data-lang="en" href="/560/Documentation/Manual/TroubleShootingIPhone.html">English</a></li>
<li><a data-lang="ja" href="/ja/560/Manual/TroubleShootingIPhone.html">日本語</a></li>
<li><a data-lang="es" href="/es/560/Manual/TroubleShootingIPhone.html">Español</a></li>
<li><a data-lang="kr" href="/kr/560/Manual/TroubleShootingIPhone.html">한국어</a></li>
<li><a data-lang="ru" href="/ru/560/Manual/TroubleShootingIPhone.html">Русский</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar hidden"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc">
<h2>手册</h2>
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>5.6</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;"><ul>
<li><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/TroubleShootingIPhone.html">2020.1</a></li>
<li><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/TroubleShootingIPhone.html">2019.3</a></li>
<li><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/TroubleShootingIPhone.html">2019.2</a></li>
<li><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/TroubleShootingIPhone.html">2019.1</a></li>
<li><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/TroubleShootingIPhone.html">2018.4</a></li>
<li><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/TroubleShootingIPhone.html">2018.3</a></li>
<li><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/TroubleShootingIPhone.html">2018.2</a></li>
<li><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/TroubleShootingIPhone.html">2018.1</a></li>
<li><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/TroubleShootingIPhone.html">2017.4</a></li>
<li><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/TroubleShootingIPhone.html">2017.3</a></li>
<li><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/TroubleShootingIPhone.html">2017.2</a></li>
<li><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/TroubleShootingIPhone.html">2017.1</a></li>
<li><a class="docs_version_url_560" href="/cn/560/Manual/TroubleShootingIPhone.html">5.6</a></li>
</ul></div>
</div>
<div class="clear"></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap opened-sidebar"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity User Manual (5.6)</a></li>
<li><a href="PlatformSpecific.html">特定于平台的信息</a></li>
<li><a href="iphone.html">iOS</a></li>
<li>在 iOS 设备上进行故障排除</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="iphone-unsupported.html"></a></span><div class="tip">Unity iOS 目前不支持的功能</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="iphone-bugreporting.html"></a></span><div class="tip">报告 iOS 上的崩溃错误</div>
</div>
</div></div>
<h1>在 iOS 设备上进行故障排除</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>在 iOS 中，有些情况下，游戏可以在 Unity Editor 中完美运行，但在实际设备上却无法运行，甚至无法启动。
这些问题通常与代码或内容质量有关。本部分将介绍最常见的情况。</p>

<h2>游戏在片刻之后停止响应。Xcode 在状态栏中显示“interrupted”。</h2>

<p>出现这种情况的原因有很多。典型原因包括：</p>

<p>1.脚本错误，例如使用未初始化的变量等。
1.使用了第三方 Thumb 编译的原生库。这些库会在 iOS SDK 链接器中触发一个已知问题，并可能导致随机崩溃。
1. Using generic types with value types as parameters (eg, List&lt;int&gt;, List&lt;SomeStruct&gt;, List&lt;SomeEnum&gt;, etc) for serializable script properties.
1.在启用托管代码剥离的情况下使用了反射。
1.原生插件接口中出错（托管代码方法签名与原生代码函数签名不匹配）。
来自 XCode 调试器控制台的信息通常有助于检测这些问题。（Xcode 菜单：__View &gt; Debug Area &gt; Activate Console__）。</p>

<h2>Xcode 控制台显示 Program received signal: “SIGBUS” 或 EXC_BAD_ACCESS 错误。</h2>

<p>This message typically appears on iOS devices when your application receives a NullReferenceException. There two ways to figure out where the fault happened: </p>

<h4>托管堆栈跟踪</h4>

<p>Unity includes software-based handling of the NullReferenceException. The AOT compiler includes quick checks for null references each time a method or variable is accessed on an object. This feature affects script performance which is why it is enabled only for development builds (enable the “script debugging” option in build settings dialog).
If everything was done right and the fault actually is occurring in .NET code then you won’t see EXC_BAD_ACCESS anymore. Instead, the .NET exception text will be printed in the Xcode console (or else your code will just handle it in a “catch” statement). Typical output might be:</p>

<pre><code>Unhandled Exception: System.NullReferenceException: A null value was found where an object instance was required.
  at DayController+$handleTimeOfDay$121+$.MoveNext () [0x0035a] in DayController.js:122
</code></pre>

<p>This indicates that the fault happened in the handleTimeOfDay method of the DayController class, which works as a coroutine. Also if it is script code then you will generally be told the exact line number (eg, “DayController.js:122”). The offending line might be something like the following:</p>

<pre><code> Instantiate(_imgwww.assetBundle.mainAsset);
</code></pre>

<p>比如，如果脚本没有事先检查其 Asset Bundle 是否下载正确而直接访问该 Asset Bundle，则可能会发生这种情况。</p>

<h4>原生堆栈跟踪</h4>

<p>Native stack traces are a much more powerful tool for fault investigation but using them requires some expertise. Also, you generally can’t continue after these native (hardware memory access) faults happen. To get a native stack trace, type <strong>bt all</strong> into the Xcode Debugger Console. Carefully inspect the printed stack traces - they may contain hints about where the error occurred. You might see something like:</p>

<pre><code>...
Thread 1 (thread 11523): 

1.0 0x006267d0 in m_OptionsMenu_Start ()
1.1 0x002e4160 in wrapper_runtime_invoke_object_runtime_invoke_void__this___object_intptr_intptr_intptr ()
1.2 0x00a1dd64 in mono_jit_runtime_invoke (method=0x18b63bc, obj=0x5d10cb0, params=0x0, exc=0x2fffdd34) at /Users/mantasp/work/unity/unity-mono/External/Mono/mono/mono/mini/mini.c:4487
1.3 0x0088481c in MonoBehaviour::InvokeMethodOrCoroutineChecked ()
...
</code></pre>

<p>First of all you should find the stack trace for <strong>“Thread 1”</strong>, which is the main thread. The very first lines of the stack trace will point to the place where the error occurred. In this example, the trace indicates that the NullReferenceException happened inside the <em>“OptionsMenu”</em> script’s <em>“Start”</em> method. Looking carefully at this method implementation would reveal the cause of the problem. Typically, NullReferenceExceptions happen inside the <strong>Start</strong> method when incorrect assumptions are made about initialization order.
In some cases only a partial stack trace is seen on the Debugger Console:</p>

<pre><code>Thread 1 (thread 11523): 

1.0 0x0062564c in start ()
</code></pre>

<p>此信息表明原生符号在应用程序的发行版构建过程中被剥离。可以通过以下过程获得完整的堆栈跟踪：</p>

<ul>
<li>从设备上删除应用程序。</li>
<li>清除所有目标。</li>
<li>构建并运行。</li>
<li>如前所述，再次获取堆栈跟踪。</li>
</ul>

<h2>当外部库链接到 Unity iOS 应用程序时，便开始发生 EXC_BAD_ACCESS。</h2>

<p>This usually happens when an external library is compiled with the ARM Thumb instruction set. Currently such libraries are not compatible with Unity. The problem can be solved easily by recompiling the library without Thumb instructions. You can do this for the library’s Xcode project with the following steps:</p>

<ul>
<li>in Xcode, select <em>“View”</em> &gt; <em>“Navigators”</em> &gt; <em>“Show Project Navigator”</em> from the menu</li>
<li>select the <em>“Unity-iPhone”</em> project, activate <em>“Build Settings”</em> tab</li>
<li>in the search field enter : <em>“Other C Flags”</em>
</li>
<li>add <em>-mno-thumb</em> flag there and rebuild the library.</li>
</ul>

<p>如果库来源不明，则应要求供应商提供库的非 Thumb 版本。</p>

<h2>Xcode 控制台显示“WARNING -&gt; applicationDidReceiveMemoryWarning()”，而且应用程序随后立即崩溃</h2>

<p>(Sometimes you might see a message like <em>Program received signal: “0”</em>.)
This warning message is often not fatal and merely indicates that iOS is low on memory and is asking applications to free up some memory. Typically, background processes like Mail will free some memory and your application can continue to run. However, if your application continues to use memory or ask for more, the OS will eventually start killing applications and yours could be one of them. Apple does not document what memory usage is safe, but empirical observations show that applications using less than 50% MB of all device RAM (roughly 200–256 MB for 2nd generation ipad) do not have major memory usage problems.
The main metric you should rely on is how much RAM your application uses. Your application memory usage consists of three major components:</p>

<ul>
<li>application code (the OS needs to load and keep your application code in RAM, but some of it might be discarded if really needed)</li>
<li>native heap (used by the engine to store its state, your assets, etc. in RAM)</li>
<li>managed heap (used by your Mono runtime to keep C# or JavaScript objects)</li>
<li>GLES driver memory pools: textures, framebuffers, compiled shaders, etc.
Your application memory usage can be tracked by two Xcode Instruments tools: <strong>Activity Monitor</strong>, <strong>Object Allocations</strong> and <strong>VM Tracker</strong>. You can start from the Xcode Run menu: <strong>Product &gt; Profile</strong> and then select specific tool. <strong>Activity Monitor</strong> tool shows all process statistics including <strong>Real memory</strong> which can be regarded as the total amount of RAM used by your application. <strong>Note:</strong> OS and device HW version combination might noticeably affect memory usage numbers, so you should be careful when comparing numbers obtained on different devices.</li>
</ul>

<figure>
<img src="../uploads/Main/ActivityMonitor.png" alt="">
</figure>

<p><strong>注意：</strong><a href="iphone-InternalProfiler.html">内部性能分析器</a>仅显示 .NET 脚本分配的堆。总内存使用量可以通过 Xcode Instruments 来确定，如上所示。此图包括应用程序二进制文件、一些标准框架缓冲区、Unity 引擎内部状态缓冲区、.NET 运行时堆（由内部性能分析器输出的数字）、GLES 驱动程序堆和其他一些杂项内容等多个部分。</p>

<p>The other tool displays all allocations made by your application and includes both native heap and managed heap statistics (don’t forget to check the <strong>Created and still living</strong> box to get the current state of the application). The important statistic is the <strong>Net bytes</strong> value.</p>

<figure>
<img src="../uploads/Main/ObjectAlloc.png" alt="">
</figure>

<p>为了降低内存使用量，请遵循以下原则：</p>

<ul>
<li>Reduce the application binary size by using the strongest iOS stripping options, and avoid unnecessary dependencies on different .NET libraries. See the <a href="class-PlayerSettings.html">player settings</a> and <a href="iphone-playerSizeOptimization.html">player size optimization</a> manual pages for further details.</li>
<li>减小内容的大小。对纹理进行 PVRTC 压缩并使用简单多边形模型。请参阅有关<a href="ReducingFilesize.html">减小文件大小</a>的手册页以了解更多信息。</li>
<li>Don’t allocate more memory than necessary in your scripts. Track mono heap size and usage with the <a href="iphone-InternalProfiler.html">internal profiler</a>
</li>
<li>
<strong>Note:</strong> with Unity 3.0, the scene loading implementation has changed significantly and now all scene assets are preloaded. This results in fewer hiccups when instantiating game objects. If you need more fine-grained control of asset loading and unloading during gameplay, you should use <a href="../ScriptReference/Resources.Load.html">Resources.Load</a> and <a href="../ScriptReference/Object.Destroy.html">Object.Destroy</a>.</li>
</ul>

<p>向操作系统查询可用内存量看起来似乎是评估应用程序性能的好办法。但是，由于操作系统使用了大量的动态缓冲区和缓存，所以可用内存统计信息很可能不可靠。唯一可靠的方法是跟踪应用程序的内存消耗，并将其用作主要指标。注意上述工具中的图是如何随着时间的推移而变化的，特别是在加载新的关卡之后。</p>

<h2>游戏从 Xcode 启动时运行正常，但在设备上手动启动时，加载第一个关卡的过程中发生崩溃。</h2>

<p>There could be several reasons for this. You need to inspect the device logs to get more details. Connect the device to your Mac, launch Xcode and select <strong>Window &gt; Organizer</strong> from the menu. Select your device in the Organizer’s left toolbar, then click on the “Console” tab and review the latest messages carefully. Additionally, you may need to investigate crash reports. You can find out how to obtain crash reports here: <a href="http://developer.apple.com/iphone/library/technotes/tn2008/tn2151.html">http://developer.apple.com/iphone/library/technotes/tn2008/tn2151.html</a>.</p>

<h2>Xcode Organizer 控制台包含消息“killed by SpringBoard”。</h2>

<p>有关 iOS 应用程序渲染其第一帧和处理输入的时间限制，并没有完善的记录。如果应用程序超过此限制，则将被 SpringBoard 终止。例如，如果应用程序中的第一个场景太大，便会发生这种情况。为了避免这个问题，建议创建一个小的初始场景，只显示一个启动画面，使用 <strong>yield</strong> 等待一两帧，然后开始加载真实场景。可以用简单的代码来实现这一点，如下所示：</p>

<pre><code>function Start() {
    yield;
    Application.LoadLevel("Test");
}
</code></pre>

<h2>Type.GetProperty() / Type.GetValue() cause crashes on the device</h2>

<p>Currently <strong>Type.GetProperty()</strong> and <strong>Type.GetValue()</strong> are supported only for the <strong>.NET 2.0 Subset</strong> profile. You can select the .NET API compatibility level in the <a href="class-PlayerSettings.html">Player Settings</a>. </p>

<p><strong>注意：</strong><strong>Type.GetProperty()</strong> 和 <strong>Type.GetValue()</strong> 可能与托管代码剥离不兼容，可能需要排除（可以在剥离过程中提供自定义的不可剥离类型列表来实现这一点）。有关更多详细信息，请参阅 <a href="iphone-playerSizeOptimization.html">iOS 播放器大小优化指南</a>。</p>

<h2>游戏崩溃并显示错误消息“ExecutionEngineException: Attempting to JIT compile method ‘SometType`1&lt;SomeValueType&gt;:.ctor ()’ while running with –aot-only.”</h2>

<p>The Mono .NET implementation for iOS is based on AOT (ahead of time compilation to native code) technology, which has its limitations. It compiles only those generic type methods (where a value type is used as a generic parameter) which are explicitly used by other code. When such methods are used only via reflection or from native code (ie, the serialization system) then they get skipped during AOT compilation. The AOT compiler can be hinted to include code by adding a dummy method somewhere in the script code. This can refer to the missing methods and so get them compiled ahead of time.</p>

<pre><code>void _unusedMethod() {
    var tmp = new SomeType&lt;SomeValueType&gt;();
}
</code></pre>

<p><strong>Note:</strong> value types are basic types, enums and structs.</p>

<h2>将 System.Security.Cryptography 与托管代码剥离组合使用时，设备上发生各种崩溃</h2>

<p>.NET Cryptography 服务严重依赖反射，所以不兼容托管代码剥离，因为这涉及静态代码分析。有时，崩溃的最简单解决方案是将整个 <strong>System.Security.Crypography</strong> 命名空间从剥离过程中排除。</p>

<p>The stripping process can be customized by adding a custom <strong>link.xml</strong> file to the <strong>Assets</strong> folder of your Unity project. This specifies which types and namespaces should be excluded from stripping. Further details can be found in the <a href="iphone-playerSizeOptimization.html">iOS player size optimization guide</a>.</p>

<h3>link.xml</h3>

<pre><code>&lt;linker&gt;
       &lt;assembly fullname="mscorlib"&gt;
               &lt;namespace fullname="System.Security.Cryptography" preserve="all"/&gt;
       &lt;/assembly&gt;
&lt;/linker&gt;
</code></pre>

<h3>将 System.Security.Cryptography.MD5 与托管代码剥离一起使用时，应用程序崩溃</h3>

<p>You might consider advice listed above or can work around this problem by adding extra reference to specific class to your script code:</p>

<pre><code>object obj = new MD5CryptoServiceProvider();
</code></pre>

<h2>“Ran out of trampolines of type 0/1/2”运行时错误</h2>

<p>This error usually happens if you use lots of recursive generics. You can hint to the AOT compiler to allocate more trampolines of type 0, type 1 or type 2. Additional AOT compiler command line options can be specified in the “Other Settings” section of the <a href="class-PlayerSettings.html">Player Settings</a>. For type 1 trampolines, specify <strong>nrgctx-trampolines=ABCD</strong>, where ABCD is the number of new trampolines required (i.e. 4096). For type 2 trampolines specify <strong>nimt-trampolines=ABCD</strong> and for type 0 trampolines specify <strong>ntrampolines=ABCD</strong>.</p>

<h2>After upgrading Xcode Unity iOS runtime fails with message “You are using Unity iPhone Basic. You are not allowed to remove the Unity splash screen from your game”</h2>

<p>With some latest Xcode releases there were changes introduced in PNG compression and optimization tool. These changes might cause false positives in Unity iOS runtime checks for splash screen modifications. If you encounter such problems try upgrading Unity to the latest publicly available version. If it does not help you might consider following workaround:</p>

<ul>
<li><p>从 Unity 进行构建时，请从头开始替换 Xcode 项目（而不是进行追加）</p></li>
<li><p>Delete already installed project from device</p></li>
<li><p>Clean project in Xcode (<em>Product</em>-&gt;<em>Clean</em>)</p></li>
<li><p>Clear Xcode’s Derived Data folders (<em>Xcode</em>-&gt;<em>Preferences</em>-&gt;<em>Locations</em>)
If this still does not help try disabling PNG re-compression in Xcode:</p></li>
<li><p>打开您的 Xcode 项目</p></li>
<li><p>Select “Unity-iPhone” project there</p></li>
<li><p>Select “Build Settings” tab there</p></li>
<li><p>Look for “Compress PNG files” option and set it to NO</p></li>
</ul>

<h2>App Store submission fails with “iPhone/iPod Touch: application executable is missing a required architecture. At least one of the following architecture(s) must be present: armv6” message</h2>

<p>You might get such message when updating already existing application, which previously was submitted with armv6 support. Unity 4.x and Xcode 4.5 does not support armv6 platform anymore. To solve submission problem just set <strong>Target OS Version</strong> in Unity <strong>Player Settings</strong> to <strong>4.3</strong> or higher.</p>

<h2>WWW 下载在 Unity Editor 和 Android 中正常工作，但在 iOS 中无效</h2>

<p>Most common mistake is to assume that WWW downloads are always happening on separate thread. On some platforms this might be true, but you should not take it for granted. Best way to track WWW status is either to use <em>yield</em> statement or check status in <em>Update</em> method. You should <strong>not</strong> use busy <em>while</em> loops for that.</p>

<h2>通过从脚本调用的原生函数来使用 Cocoa 时，发生“PlayerLoop called recursively!”错误</h2>

<p>Some operations with the UI will result in iOS redrawing the window immediately (the most common example is adding a UIView with a UIViewController to the main UIWindow). If you call a native function from a script, it will happen inside Unity’s PlayerLoop, resulting in PlayerLoop being called recursively. In such cases, you should consider using the <a href="http://developer.apple.com/library/mac/#documentation/Cocoa/Reference/Foundation/Classes/NSObject_Class/Reference/Reference.html#//apple_ref/occ/instm/NSObject/performSelectorOnMainThread:withObject:waitUntilDone:">performSelectorOnMainThread</a> method with waitUntilDone set to false. It will inform iOS to schedule the operation to run between Unity’s PlayerLoop calls.</p>

<h2>性能分析器或调试器无法看到游戏在 iOS 设备上运行</h2>

<ul>
<li>Check that you have built a Development build, and ticked the “Enable Script Debugging” and “Autoconnect profiler” boxes (as appropriate).</li>
<li>在设备上运行的应用程序将在 UDP 端口 54997 上向 225.0.0.222 进行多播广播。请检查您的网络设置是否允许此流量。然后，性能分析器将连接到远程设备上 55000 到 55511 范围内的端口，以便从设备中获取性能分析器数据。需要打开这些端口来进行 UDP 访问。</li>
</ul>

<h2>缺少 DLL</h2>

<p>If your application runs ok in editor but you get errors in your iOS project this may be caused by missing DLLs (e.g. I18N.dll, I19N.West.dll). In this case, try copying those dlls from within the Unity.app to your project’s Assets/Plugins folder. The location of the DLLs within the unity app is:
 Unity.app/Contents/Frameworks/Mono/lib/mono/unity
You should then also check the stripping level of your project to ensure the classes in the DLLs aren’t being removed when the build is optimised. Refer to the <a href="iphone-playerSizeOptimization.html">iOS Optimisation Page</a> for more information on iOS Stripping Levels.</p>

<h2>Xcode 调试器控制台报告：ExecutionEngineException: Attempting to JIT compile method ‘(wrapper native-to-managed) Test:TestFunc (int)’ while running with –aot-only</h2>

<p>Typically such message is received when managed function delegate is passed to the native function, but required wrapper code wasn’t generated when building application. You can help AOT compiler by hinting which methods will be passed as delegates to the native code. This can be done by adding “MonoPInvokeCallbackAttribute” custom attribute. Currently only static methods can be passed as delegates to the native code.</p>

<p>代码示例：</p>

<pre><code>using UnityEngine;
using System.Collections;
using System;
using System.Runtime.InteropServices;
using AOT;

public class NewBehaviourScript : MonoBehaviour {
    [DllImport ("__Internal")]
    private static extern void DoSomething (NoParamDelegate del1, StringParamDelegate del2);

    delegate void NoParamDelegate ();
    delegate void StringParamDelegate (string str);
    
    [MonoPInvokeCallback(typeof(NoParamDelegate))]
    public static void NoParamCallback() {
        Debug.Log ("Hello from NoParamCallback");
    }
    
    [MonoPInvokeCallback(typeof(StringParamDelegate))]
    public static void StringParamCallback(string str) {
        Debug.Log(string.Format("Hello from StringParamCallback {0}", str));
    }

    // 用于进行初始化
    void Start() {
        DoSomething(NoParamCallback, StringParamCallback);
    }
}
</code></pre>

<h2>Xcode 抛出编译错误：“ld : unable to insert branch island.No insertion point available. for architecture armv7”、“clang: error: linker command failed with exit code 1 (use -v to see invocation)”</h2>

<p>That error usually means there is just too much code in single module. Typically it is caused by having lots of script code or having big external .NET assemblies included into build. And enabling script debugging might make things worse, because it adds quite few additional instructions to each function, so it is easier to hit that limit.</p>

<p>Enabling managed code stripping in <a href="class-PlayerSettings.html">player settings</a> might help with this problem, especially if big external .NET assemblies are involved. But if the issue persists then the best solution is to split user script code into multiple assemblies. The easiest way to this is move some code to <strong>Plugins</strong> folder. Code at this location is put to different assembly. Also check the information about how <a href="ScriptCompileOrderFolders.html">special folder names</a> affect script compilation:</p>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="iphone-unsupported.html"></a></span><div class="tip">Unity iOS 目前不支持的功能</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="iphone-bugreporting.html"></a></span><div class="tip">报告 iOS 上的崩溃错误</div>
</div>
</div>
</div>
<div class="footer-wrapper">
<div class="footer clear">
<div class="copy">Copyright © 2017 Unity Technologies. Publication 5.6</div>
<div class="menu">
<a href="http://unity3d.com/learn">教程</a><a href="http://answers.unity3d.com">社区答案</a><a href="https://support.unity3d.com/hc/en-us">知识库</a><a href="http://forum.unity3d.com">论坛</a><a href="http://unity3d.com/asset-store">Asset Store</a>
</div>
</div>
<div></div>
</div>
</div></div></div>
</div>
</body>
</html>
