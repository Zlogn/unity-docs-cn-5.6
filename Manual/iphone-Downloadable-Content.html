<!DOCTYPE html><html class="no-js" lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-5V25JL6');
    </script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="twitter:card" content="summary">
<meta name="robots" content="noindex">
<meta property="og:title" content='Preparing your application for "In App Purchases" - Unity 手册'>
<title>Preparing your application for "In App Purchases" - Unity 手册</title>
<meta name="description" content="本章不介绍如何将游戏与 Apple 的 StoreKit API 进行集成。此处假设已经通过原生代码插件与 StoreKit 进行集成。">
<meta property="og:description" content="本章不介绍如何将游戏与 Apple 的 StoreKit API 进行集成。此处假设已经通过原生代码插件与 StoreKit 进行集成。">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="../StaticFiles/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFiles/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png">
<script>
      var docs_type = 'Manual';
      var lang = 'cn';
      var page = 'iphone-Downloadable-Content';
      if(!page) page = 'index';
      var version = '560';
      var docs_versions = [{version: '2020.1',version_string: '2020.1'},{version: '2019.3',version_string: '2019.3'},{version: '2019.2',version_string: '2019.2'},{version: '2019.1',version_string: '2019.1'},{version: '2018.4',version_string: '2018.4'},{version: '2018.3',version_string: '2018.3'},{version: '2018.2',version_string: '2018.2'},{version: '2018.1',version_string: '2018.1'},{version: '2017.4',version_string: '2017.4'},{version: '2017.3',version_string: '2017.3'},{version: '2017.2',version_string: '2017.2'},{version: '2017.1',version_string: '2017.1'},{version: '5.6',version_string: '560'},];</script><script type="text/javascript" src="../StaticFiles/js/jquery.js"></script><script type="text/javascript" src="../StaticFiles/js/core.js"></script><script type="text/javascript" src="../StaticFiles/js/jquery.sidebar.min.js"></script><script type="text/javascript" src="docdata/toc.js"></script><script type="text/javascript" src=""></script><script type="text/javascript" src="../StaticFiles/js/custom.js"></script><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,400italic" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/custom.css">
<link rel="canonical" href="https://docs.unity3d.com/cn/560/Manual/iphone-Downloadable-Content.html">
<link rel="alternate" href="https://docs.unity3d.com/en/560/Manual/iphone-Downloadable-Content.html" hreflang="en">
<link rel="alternate" href="https://docs.unity3d.com/ja/560/Manual/iphone-Downloadable-Content.html" hreflang="ja">
<link rel="alternate" href="https://docs.unity3d.com/es/560/Manual/iphone-Downloadable-Content.html" hreflang="es">
<link rel="alternate" href="https://docs.unity3d.com/kr/560/Manual/iphone-Downloadable-Content.html" hreflang="ko">
<link rel="alternate" href="https://docs.unity3d.com/ru/560/Manual/iphone-Downloadable-Content.html" hreflang="ru">
<link rel="alternate" href="https://docs.unity3d.com/560/Documentation/Manual/iphone-Downloadable-Content.html" hreflang="x-default">
</head>
<body>
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="http://docs.unity3d.com"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="搜索手册..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul class="menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity3d.com/">
                unity3d.com
              </a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>5.6</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;"><ul>
<li><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/iphone-Downloadable-Content.html">2020.1</a></li>
<li><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/iphone-Downloadable-Content.html">2019.3</a></li>
<li><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/iphone-Downloadable-Content.html">2019.2</a></li>
<li><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/iphone-Downloadable-Content.html">2019.1</a></li>
<li><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/iphone-Downloadable-Content.html">2018.4</a></li>
<li><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/iphone-Downloadable-Content.html">2018.3</a></li>
<li><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/iphone-Downloadable-Content.html">2018.2</a></li>
<li><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/iphone-Downloadable-Content.html">2018.1</a></li>
<li><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/iphone-Downloadable-Content.html">2017.4</a></li>
<li><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/iphone-Downloadable-Content.html">2017.3</a></li>
<li><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/iphone-Downloadable-Content.html">2017.2</a></li>
<li><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/iphone-Downloadable-Content.html">2017.1</a></li>
<li><a class="docs_version_url_560" href="/cn/560/Manual/iphone-Downloadable-Content.html">5.6</a></li>
</ul></div>
</div>
<ul class="nav-menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">语言:
        <span class="b">中文</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a data-lang="en" href="/560/Documentation/Manual/iphone-Downloadable-Content.html">English</a></li>
<li><a data-lang="ja" href="/ja/560/Manual/iphone-Downloadable-Content.html">日本語</a></li>
<li><a data-lang="es" href="/es/560/Manual/iphone-Downloadable-Content.html">Español</a></li>
<li><a data-lang="kr" href="/kr/560/Manual/iphone-Downloadable-Content.html">한국어</a></li>
<li><a data-lang="ru" href="/ru/560/Manual/iphone-Downloadable-Content.html">Русский</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar hidden"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc">
<h2>手册</h2>
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>5.6</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;"><ul>
<li><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/iphone-Downloadable-Content.html">2020.1</a></li>
<li><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/iphone-Downloadable-Content.html">2019.3</a></li>
<li><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/iphone-Downloadable-Content.html">2019.2</a></li>
<li><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/iphone-Downloadable-Content.html">2019.1</a></li>
<li><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/iphone-Downloadable-Content.html">2018.4</a></li>
<li><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/iphone-Downloadable-Content.html">2018.3</a></li>
<li><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/iphone-Downloadable-Content.html">2018.2</a></li>
<li><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/iphone-Downloadable-Content.html">2018.1</a></li>
<li><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/iphone-Downloadable-Content.html">2017.4</a></li>
<li><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/iphone-Downloadable-Content.html">2017.3</a></li>
<li><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/iphone-Downloadable-Content.html">2017.2</a></li>
<li><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/iphone-Downloadable-Content.html">2017.1</a></li>
<li><a class="docs_version_url_560" href="/cn/560/Manual/iphone-Downloadable-Content.html">5.6</a></li>
</ul></div>
</div>
<div class="clear"></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap opened-sidebar"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity User Manual (5.6)</a></li>
<li><a href="PlatformSpecific.html">特定于平台的信息</a></li>
<li><a href="iphone.html">iOS</a></li>
<li>iOS 高级主题</li>
<li>Preparing your application for "In App Purchases"</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="PluginsForIOS.html"></a></span><div class="tip">构建适用于 iOS 的插件</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="iosCustomWWWRequest.html"></a></span><div class="tip">Customising WWW Requests on iOS</div>
</div>
</div></div>
<h1>Preparing your application for “In App Purchases”</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>本章<strong>不</strong>介绍如何将游戏与 Apple 的 <em>StoreKit</em> API 进行集成。此处假设已经通过<a href="Plugins.html">原生代码插件</a>与 StoreKit 进行集成。</p>

<p>The Apple StoreKit documentation defines four kinds of products that can be sold via the <em>In App Purchase</em> process: </p>

<ul>
<li>内容 (Content)</li>
<li>功能 (Functionality)</li>
<li>服务 (Services)</li>
<li>订阅 (Subscriptions)</li>
</ul>

<p>本章仅介绍第一种情况，主要侧重于可下载内容概念。建议使用 <a href="../ScriptReference/AssetBundle.html">AssetBundles</a> 在 Unity 中实现可下载内容，这里将介绍 AssetBundles 的创建和运行时使用。</p>

<h2>导出资源以便在 iOS 上使用</h2>

<p>为主应用程序和将使用的可下载 AssetBundles 维护单独的项目有时很有用。但是，应该注意，AssetBundle 中的对象引用的所有_脚本_必须存在于主游戏可执行文件中。用于创建 AssetBundle 的项目必须将 iOS 作为选定的构建目标，因为 AssetBundle 文件的内容在 iOS 和其他平台之间不兼容。</p>

<p>AssetBundles are created using editor scripts - a simple example is given below:-</p>

<pre><code>// C#
using UnityEngine;
using UnityEditor;

public class ExportBundle : MonoBehaviour {
    [MenuItem ("Assets/Build AssetBundle From Selection - Track dependencies")]
    static void DoExport() {
        string str = EditorUtility.SaveFilePanel("Save Bundle...", Application.dataPath, Selection.activeObject.name, "assetbundle");
        if (str.Length != 0) {
            BuildPipeline.BuildAssetBundle(Selection.activeObject, Selection.objects, str, BuildAssetBundleOptions.CompleteAssets, BuildTarget.iPhone);
        }
    }
}

// JS
@MenuItem ("Assets/Build AssetBundle From Selection - Track dependencies")
static function ExportBundle() {
    var str : String = EditorUtility.SaveFilePanel("Save Bundle...", Application.dataPath, Selection.activeObject.name, "assetbundle");
    if (str.Length != 0) {
        BuildPipeline.BuildAssetBundle(Selection.activeObject, Selection.objects, str, BuildAssetBundleOptions.CompleteAssets, BuildTarget.iPhone);
    }
}
</code></pre>

<p>You should save this code in a file called ExportBundle and place it inside a folder called Editor (you can just create this if it isn’t already present in the project). The script will add a menu item entitled “Build AssetBundle From Selection - Track dependencies” on the Assets menu in the editor.</p>

<p>The content you want to include in the bundle should be prepared in the form of prefabs. Select a prefab in the Project view and then select <em>Assets &gt; Build AssetBundle From Selection - Track dependencies</em> (ie, the menu item added by the ExportBundle script). This command will bring up a save dialog where you can choose the name and location of your AssetBundle file.</p>

<h2>在 iOS 上下载资源</h2>

<p><strong>Note:</strong> Apple may change the folder locations where you are permitted to write data. Always check the latest Apple documentation to be sure your application will be compliant. The following advice was correct as of early 2013.</p>

<p>AssetBundles can be downloaded using the <a href="../ScriptReference/WWW.html">WWW class</a> and once transfer is complete, the enclosed assets can be accessed. The recommended way to download an AssetBundle is to use <a href="../ScriptReference/WWW.LoadFromCacheOrDownload.html">LoadFromCacheOrDownload</a> as shown in the following sample:-</p>

<pre><code>// C#
IEnumerator GetAssetBundle() {
    WWW download;
    string url = "http://somehost/somepath/someassetbundle.assetbundle";

    while (!Caching.ready)
        yield return null;

    download = WWW.LoadFromCacheOrDownload(url, 0);

    yield return download;

    AssetBundle assetBundle = download.assetBundle;
    if (assetBundle != null) {
        // Alternatively you can also load an asset by name (assetBundle.Load("my asset name"))
        Object go = assetBundle.mainAsset;
            
        if (go != null)
            Instantiate(go);
        else
            Debug.Log("Couldn't load resource");    
    } else {
        Debug.Log("Couldn't load resource");    
    }
}

// JS
function GetAssetBundle() {
    var download : WWW;
    var url = "http://somehost/somepath/someassetbundle.assetbundle";
    var download = WWW.LoadFromCacheOrDownload (url, 0);

    yield download;

    var assetBundle = download.assetBundle;
    if (assetBundle != null) {
        // Alternatively you can also load an asset by name (assetBundle.Load("my asset name"))
        var go : Object = assetBundle.mainAsset;
            
        if (go != null)
            Instantiate(go);
        else
            Debug.Log("Couldn't load resource");    
    } else {
        Debug.Log("Couldn't load resource");    
    }
}
</code></pre>

<p>The downloaded asset bundle files are stored in the <code>Library</code> folder of the iOS application sandbox and have the <em>No Backup</em> flag set on them. This means the OS won’t delete these files accidentally and these files won’t be backed up to iCloud. It is good idea to keep the <a href="../ScriptReference/Caching-maximumAvailableDiskSpace.html">cache size limit</a> low, to prevent your app from grabbing all the device’s disk space.</p>

<p>If you need to choose exactly where the AssetBundle file is stored, you can use a standard WWW download (ie, just use the constructor instead of LoadFromCacheOrDownload) and then save the downloaded data on disk using the .NET file API. You can save required files to the <a href="../ScriptReference/Application-temporaryCachePath.html">Application.temporaryCachePath</a> folder (stored in <em>Library/Caches</em> which is regularly “cleaned out” by the OS) or the <a href="../ScriptReference/Application-persistentDataPath.html">Application.persistentDataPath</a> folder (stored in <em>Documents</em> which is not cleaned out by the OS). You should set the <em>No Backup</em> flag on these files with <a href="../ScriptReference/iOS.Device.SetNoBackupFlag.html">iOS.Device.SetNoBackupFlag</a> to prevent them being backed up to iCloud.</p>

<p><strong>注意：</strong>如果未设置 <em>No Backup</em> 标志，则在将应用程序提交到 App Store 时可能会遭到拒绝。</p>

<p>可以通过使用 <code>file:///pathtoyourapplication/Library/savedassetbundle.assetbundle</code> 形式的 URL 创建 WWW 对象来访问已保存的文件：</p>

<pre><code>// C#
string cachedAssetBundle = Application.temporaryCachePath + "/savedassetbundle.assetbundle"; 
System.IO.FileStream cache = new System.IO.FileStream(cachedAssetBundle, System.IO.FileMode.Create);
cache.Write(download.bytes, 0, download.bytes.Length);
cache.Close();

iOS.Device.SetNoBackupFlag(cachedAssetBundle);

Debug.Log("Cache saved: " + cachedAssetBundle);

// JS
private var cachedAssetBundle : String = Application.temporaryCachePath + "/savedassetbundle.assetbundle"; 
var cache = new System.IO.FileStream(cachedAssetBundle, System.IO.FileMode.Create);
cache.Write(download.bytes, 0, download.bytes.Length);
cache.Close();

iOS.Device.SetNoBackupFlag(cachedAssetBundle);

Debug.Log("Cache saved: " + cachedAssetBundle);
</code></pre>

<p><strong>Note:</strong> You can test the reading of stored files in the Documents folder if you enable <em>file sharing</em> (setting <code>UIFileSharingEnabled</code> to true in your <code>Info.plist</code> allows you to access the Documents folder from iTunes). Note that the contents of the Documents folder are cached to iCloud, so you should not use this location to store AssetBundles in the final build to be shipped. See <a href="http://developer.apple.com/library/ios/documentation/FileManagement/Conceptual/FileSystemProgrammingGUide/FileSystemOverview/FileSystemOverview.html">File System Basics</a> in the Apple iOS documentation for further details.</p>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="PluginsForIOS.html"></a></span><div class="tip">构建适用于 iOS 的插件</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="iosCustomWWWRequest.html"></a></span><div class="tip">Customising WWW Requests on iOS</div>
</div>
</div>
</div>
<div class="footer-wrapper">
<div class="footer clear">
<div class="copy">Copyright © 2017 Unity Technologies. Publication 5.6</div>
<div class="menu">
<a href="http://unity3d.com/learn">教程</a><a href="http://answers.unity3d.com">社区答案</a><a href="https://support.unity3d.com/hc/en-us">知识库</a><a href="http://forum.unity3d.com">论坛</a><a href="http://unity3d.com/asset-store">Asset Store</a>
</div>
</div>
<div></div>
</div>
</div></div></div>
</div>
</body>
</html>
