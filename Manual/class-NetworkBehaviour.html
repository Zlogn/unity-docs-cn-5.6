<!DOCTYPE html><html class="no-js">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-MC35ML');
    </script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="twitter:card" content="summary">
<meta name="robots" content="noindex">
<meta property="og:title" content="NetworkBehaviour  - Unity Manual">
<title>NetworkBehaviour  - Unity Manual</title>
<meta property="og:image" content="https://docs.unity3d.com/zh_CN/5.6/uploads/Main/UNetDirections.jpg">
<meta name="description" content="NetworkBehaviours are special scripts that work with objects with the NetworkIdentity component. These scripts are able to perform HLAPI functions such as Commands, ClientRPCs, SyncEvents and SyncVars.">
<meta property="og:description" content="NetworkBehaviours are special scripts that work with objects with the NetworkIdentity component. These scripts are able to perform HLAPI functions such as Commands, ClientRPCs, SyncEvents and SyncVars.">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="../StaticFiles/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFiles/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png">
<script>
      var docs_type = 'Manual';
      var lang = 'zh_CN';
      var page = 'class-NetworkBehaviour';
      if(!page) page = 'index';
      var version = '560';
      var docs_versions = [{version: '2019.1',version_string: '2019.1'},{version: '2018.3',version_string: '2018.3'},{version: '2018.2',version_string: '2018.2'},{version: '2018.1',version_string: '2018.1'},{version: '2017.4',version_string: '2017.4'},{version: '2017.3',version_string: '2017.3'},{version: '2017.2',version_string: '2017.2'},{version: '2017.1',version_string: '2017.1'},{version: '5.6',version_string: '560'},{version: '5.5',version_string: '550'},{version: '5.4',version_string: '540'},{version: '5.3',version_string: '530'},];</script><script type="text/javascript" src="../StaticFiles/js/jquery.js"></script><script type="text/javascript" src="../StaticFiles/js/core.js"></script><script type="text/javascript" src="../StaticFiles/js/jquery.sidebar.min.js"></script><script type="text/javascript" src="docdata/toc.js"></script><script type="text/javascript" src=""></script><script type="text/javascript" src="../StaticFiles/js/custom.js"></script><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,400italic" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/custom.css">
</head>
<body>
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MC35ML" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="http://docs.unity3d.com"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="Search manual..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul class="menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">Manual</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">Scripting API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity3d.com/">
                unity3d.com
              </a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>5.6</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;"><ul>
<li><a class="docs_version_url_2019.1" href="/zh_CN/2019.1/Manual/class-NetworkBehaviour.html">2019.1</a></li>
<li><a class="docs_version_url_2018.3" href="/zh_CN/2018.3/Manual/class-NetworkBehaviour.html">2018.3</a></li>
<li><a class="docs_version_url_2018.2" href="/zh_CN/2018.2/Manual/class-NetworkBehaviour.html">2018.2</a></li>
<li><a class="docs_version_url_2018.1" href="/zh_CN/2018.1/Manual/class-NetworkBehaviour.html">2018.1</a></li>
<li><a class="docs_version_url_2017.4" href="/zh_CN/2017.4/Manual/class-NetworkBehaviour.html">2017.4</a></li>
<li><a class="docs_version_url_2017.3" href="/zh_CN/2017.3/Manual/class-NetworkBehaviour.html">2017.3</a></li>
<li><a class="docs_version_url_2017.2" href="/zh_CN/2017.2/Manual/class-NetworkBehaviour.html">2017.2</a></li>
<li><a class="docs_version_url_2017.1" href="/zh_CN/2017.1/Manual/class-NetworkBehaviour.html">2017.1</a></li>
<li><a class="docs_version_url_560" href="/zh_CN/560/Manual/class-NetworkBehaviour.html">5.6</a></li>
<li><a class="docs_version_url_550" href="/zh_CN/550/Manual/class-NetworkBehaviour.html">5.5</a></li>
<li><a class="docs_version_url_540" href="/zh_CN/540/Manual/class-NetworkBehaviour.html">5.4</a></li>
<li><a class="docs_version_url_530" href="/zh_CN/530/Manual/class-NetworkBehaviour.html">5.3</a></li>
</ul></div>
</div>
<ul class="nav-menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">Manual</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">Scripting API</a></li>
</ul>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">Language:
        <span class="b">中文</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a data-lang="en" href="/560/Documentation/Manual/class-NetworkBehaviour.html">English</a></li>
<li><a data-lang="ja" href="/ja/560/Manual/class-NetworkBehaviour.html">日本語</a></li>
<li><a data-lang="es" href="/es/560/Manual/class-NetworkBehaviour.html">Español</a></li>
<li><a data-lang="kr" href="/kr/560/Manual/class-NetworkBehaviour.html">한국어</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar hidden"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc">
<h2>Manual</h2>
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>5.6</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;"><ul>
<li><a class="docs_version_url_2019.1" href="/zh_CN/2019.1/Manual/class-NetworkBehaviour.html">2019.1</a></li>
<li><a class="docs_version_url_2018.3" href="/zh_CN/2018.3/Manual/class-NetworkBehaviour.html">2018.3</a></li>
<li><a class="docs_version_url_2018.2" href="/zh_CN/2018.2/Manual/class-NetworkBehaviour.html">2018.2</a></li>
<li><a class="docs_version_url_2018.1" href="/zh_CN/2018.1/Manual/class-NetworkBehaviour.html">2018.1</a></li>
<li><a class="docs_version_url_2017.4" href="/zh_CN/2017.4/Manual/class-NetworkBehaviour.html">2017.4</a></li>
<li><a class="docs_version_url_2017.3" href="/zh_CN/2017.3/Manual/class-NetworkBehaviour.html">2017.3</a></li>
<li><a class="docs_version_url_2017.2" href="/zh_CN/2017.2/Manual/class-NetworkBehaviour.html">2017.2</a></li>
<li><a class="docs_version_url_2017.1" href="/zh_CN/2017.1/Manual/class-NetworkBehaviour.html">2017.1</a></li>
<li><a class="docs_version_url_560" href="/zh_CN/560/Manual/class-NetworkBehaviour.html">5.6</a></li>
<li><a class="docs_version_url_550" href="/zh_CN/550/Manual/class-NetworkBehaviour.html">5.5</a></li>
<li><a class="docs_version_url_540" href="/zh_CN/540/Manual/class-NetworkBehaviour.html">5.4</a></li>
<li><a class="docs_version_url_530" href="/zh_CN/530/Manual/class-NetworkBehaviour.html">5.3</a></li>
</ul></div>
</div>
<div class="clear"></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap opened-sidebar"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity User Manual (5.6)</a></li>
<li><a href="UNet.html">多玩家和联网</a></li>
<li><a href="UNetReference.html">Networking Reference</a></li>
<li>NetworkBehaviour </li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="class-NetworkAnimator.html"></a></span><div class="tip">NetworkAnimator</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="class-NetworkClient.html"></a></span><div class="tip">NetworkClient </div>
</div>
</div></div>
<h1>NetworkBehaviour</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>NetworkBehaviours are special scripts that work with objects with the NetworkIdentity component. These scripts are able to perform HLAPI functions such as Commands, ClientRPCs, SyncEvents and SyncVars.</p>

<p>With the server authoritative system of the Unity Network System, networked objects with NetworkIdentities must be “spawned” by the server using NetworkServer.Spawn(). This causes them to be assigned a NetworkInstanceId and be created on clients that are connected to the server. </p>

<h2>属性</h2>

<table>
<colgroup>
<col style="text-align:left;">
<col style="text-align:left;">
<col style="text-align:left;">
</colgroup>

<thead>
<tr>
	<th style="text-align:left;" colspan="2"><strong><em>属性：</em></strong></th>
	<th style="text-align:left;"><strong><em>功能：</em></strong></th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;" colspan="2"><strong>isLocalPlayer</strong></td>
	<td style="text-align:left;">True if this object is the player object for the local client.</td>
</tr>
<tr>
	<td style="text-align:left;" colspan="2"><strong>isServer</strong></td>
	<td style="text-align:left;">如果此对象在服务器上运行并且已生成，则为 true。</td>
</tr>
<tr>
	<td style="text-align:left;" colspan="2"><strong>isClient</strong></td>
	<td style="text-align:left;">如果此对象在客户端上运行，则为 true。</td>
</tr>
<tr>
	<td style="text-align:left;" colspan="2"><strong>hasAuthority</strong></td>
	<td style="text-align:left;">True if this object is the authoritative version of the object. So either on the server, or on the client with localPlayerAuthority.</td>
</tr>
<tr>
	<td style="text-align:left;" colspan="2"><strong>assetId</strong></td>
	<td style="text-align:left;">This is the assetId of the object’s NetworkIdentity.</td>
</tr>
<tr>
	<td style="text-align:left;" colspan="2"><strong>netId</strong></td>
	<td style="text-align:left;">This is the netId of the object’s NetworkIdentity.</td>
</tr>
<tr>
	<td style="text-align:left;" colspan="2"><strong>playerControllerId</strong></td>
	<td style="text-align:left;">This is the playerControllerId of the object’s NetworkIdentity.</td>
</tr>
<tr>
	<td style="text-align:left;" colspan="2"><strong>connectionToServer</strong></td>
	<td style="text-align:left;">NetworkConnection object to use to send to the server.</td>
</tr>
<tr>
	<td style="text-align:left;" colspan="2"><strong>connectionToClient</strong></td>
	<td style="text-align:left;">NetworkConnection object to use to send to the client.</td>
</tr>
</tbody>
</table>

<p>NetworkBehaviours have the following features that are described below.</p>

<ul>
<li>Synchronized Variables</li>
<li>网络回调</li>
<li>Server and Client functions</li>
<li>Sending Commands</li>
<li>Client RPC Calls</li>
<li>Networked Events</li>
</ul>

<figure>
<img src="../uploads/Main/UNetDirections.jpg" alt="">
</figure>

<h3>Synchronized Variables</h3>

<p>Member variables of NetworkBehaviours can be synchronized from the server to clients. Since the server is authoritative in this system, synchronization is only in the server-to-client direction. Requests for clients to do things are handled by Commands, not by variables synchronized from clients.</p>

<p>The <a href="../ScriptReference/Networking.SyncVarAttribute.html">SyncVar</a> attribute is used to tag member variables as being synchronized. SyncVars can be any basic type, not classes, lists, or other collections.</p>

<pre><code>public class SpaceShip : NetworkBehaviour
{
    [SyncVar]
    public int health;

    [SyncVar]
    public string playerName;
}
</code></pre>

<p>When the value of a SyncVar is changed on the server, it will be sent to all of the ready clients in the game. When objects are spawned, they are created on the client with the latest state of all SyncVars from the server.</p>

<h3>Network callbacks</h3>

<p>There are callback functions that are invoked on NetworkBehaviour script for various network events. These are virtual functions on the base class, so they can be overridden in use code like this:</p>

<pre><code>public class SpaceShip : NetworkBehaviour
{
    public override void OnStartServer()
    {
        // disable client stuff
    }

    public override void OnStartClient()
    {
        // register client events, enable effects
    }
}
</code></pre>

<p>The OnStartServer function is called when an object is spawned on the server, or when the server is started for objects in the scene. The OnStartClient function is called when the object is spawned on the client, or when the client connects to a server for objects in the scene. These functions are useful to do things that are specific to either the client or server, such as suppressing effects on a server, or setting up client-side events.</p>

<p>Note that when a local client is being used, both of these functions will be called on the same object.</p>

<p>Other callbacks include:</p>

<ul>
<li>OnSerialize - called to gather state to send from the server to clients</li>
<li>OnDeSerialize - called to apply state to objects on clients</li>
<li>OnNetworkDestroy - called on clients when server told the object to be destroyed</li>
<li>OnStartLocalPlayer - called on clients for player objects for the local client (only)</li>
<li>OnRebuildObservers - called on the server when the set of observers for an object is rebuild</li>
<li>OnSetLocalVisibility - called on a host when the visibility of an object changes for the local client</li>
<li>OnCheckObserver - called on the server to check visibility state for a new client</li>
</ul>

<h3>Server and Client functions</h3>

<p>Member functions in NetworkBehaviours can be tagged with custom attributes to designate them as server-only or client-only functions. For example:</p>

<pre><code>using UnityEngine;
using UnityEngine.Networking;

public class SimpleSpaceShip : NetworkBehaviour
{
    int health;

    [Server]
    public void TakeDamage( int amount)
    {
        // will only work on server
        health -= amount;
    }

    [Client]
    void ShowExplosion()
    {
        // will only run on client
    }

    [ClientCallback]
    void Update()
    {
        // engine invoked callback - will only run on client
    }
}
</code></pre>

<p>These attributes make the function return immediately if they are called when the client or server is not active. They do not generate compile time errors, but they will emit a warning log message if called in the wrong scope. The attributes <a href="../ScriptReference/Networking.ServerCallbackAttribute.html">ServerCallback</a> and <a href="../ScriptReference/Networking.ClientCallbackAttribute.html">ClientCallback</a> can be used for engine callback functions that user code does not control the calling of. These attributes do not cause a warning to be generated.</p>

<h3>Sending Commands</h3>

<p>Commands are the way for clients to request to do something on the server. Since the HLAPI is a server authoritative system, clients can ONLY do things through commands. Commands are run on the player object on the server that corresponds to the client that sent the command. This routing happens automatically, so it is impossible for a client to send a command for a different player.</p>

<p>Commands must begin with the prefix “Cmd” and have the [Command] custom attribute on them, like below:</p>

<pre><code>using UnityEngine;
using UnityEngine.Networking;

public class SpaceShip : NetworkBehaviour
{
    bool alive;
    float thrusting;
    int spin;

    [Command]
    public void CmdThrust(float thrusting, int spin)
    {   
        if (!alive)
        {
            this.thrusting = 0;
            this.spin = 0;
            return;
        }
            
        this.thrusting = thrusting;
        this.spin = spin;
    }

    [ClientCallback]
    void Update()
    {
        int spin = 0;
        if (Input.GetKey(KeyCode.LeftArrow))
        {
            spin += 1;
        }
        if (Input.GetKey(KeyCode.RightArrow))
        {
            spin -= 1;
        }
        // this will be called on the server
        CmdThrust(Input.GetAxis("Vertical"), spin);
    }
}
</code></pre>

<p>Commands are called just by invoking the function normally on the client. But instead of the command function running on the client, it will be invoked on the player object of that client on the server. So, commands are typesafe, have built-in security and routing to the player, and use an efficient serialization mechanism for the arguments to make calling them fast.</p>

<h3>Client RPC Calls</h3>

<p>Client RPC calls are a way for server objects to cause things to happen on client objects. This is the reverse direction to how commands send messages, but the concepts are the same. Client RPC calls however are not only invoked on player objects, they can be invoked on any NetworkIdentity object. They must begin with the prefix “Rpc” and have the [ClientRPC] custom attribute, like below:</p>

<pre><code>using UnityEngine;
using UnityEngine.Networking;

public class SpaceShipRpc : NetworkBehaviour
{
    [ClientRpc]
    public void RpcDoOnClient(int foo)
    {
        Debug.Log("OnClient " + foo);
    }

    [ServerCallback]
    void Update()
    {
        int value = UnityEngine.Random.Range(0,100);
        if (value &lt; 10)
        {
            // this will be invoked on all clients
            RpcDoOnClient(value);
        }
    }
}
</code></pre>

<h3>Networked Events</h3>

<p>Networked events are like Client RPC calls, but instead of just calling a function on the client object, an Event on the client object is triggered. Other scripts that are registered for the event are then invoked - with the arguments from the server, so this allows networked inter-script interactions on the client. Events must start with the prefix “Event” and have the <a href="../ScriptReference/Networking.SyncEventAttribute.html">SyncEvent</a> custom attribute.</p>

<p>Events can be used to build powerful networked game systems that can be extended by other scripts. This example shows how an effect script on the client can respond to events generated by a combat script on the server.</p>

<pre><code>using UnityEngine;
using UnityEngine.Networking;

// Server script
public class MyCombat : NetworkBehaviour
{
    public delegate void TakeDamageDelegate(int amount);
    public delegate void DieDelegate();
    public delegate void RespawnDelegate();
    
    float deathTimer;
    bool alive;
    int health;

    [SyncEvent(channel=1)]
    public event TakeDamageDelegate EventTakeDamage;
    
    [SyncEvent]
    public event DieDelegate EventDie;
    
    [SyncEvent]
    public event RespawnDelegate EventRespawn;

    [Server]
    void EventTakeDamage(int amount)
    {
        if (!alive)
            return;
            
        if (health &gt; amount) {
            health -= amount;
        }
        else
        {
            health = 0;
            alive = false;
            // send die event to all clients
            EventDie();
            deathTimer = Time.time + 5.0f;
        }
    }

    [ServerCallback]
    void Update()
    {
        if (!alive)
        {
            if (Time.time &gt; deathTimer)
            {
                Respawn();
            }
            return;
        }
    }

    [Server]
    void Respawn()
    {
        alive = true;
        // send respawn event to all clients
        EventRespawn();
    }
}
</code></pre>

<h2>提示</h2>

<ul>
<li>This is a base class that provides Commands and ClientRpc calls.</li>
</ul>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="class-NetworkAnimator.html"></a></span><div class="tip">NetworkAnimator</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="class-NetworkClient.html"></a></span><div class="tip">NetworkClient </div>
</div>
</div>
</div>
<div class="footer-wrapper">
<div class="footer clear">
<div class="copy">Copyright © 2017 Unity Technologies. Publication 5.6</div>
<div class="menu">
<a href="http://unity3d.com/learn">Tutorials</a><a href="http://answers.unity3d.com">Community Answers</a><a href="https://support.unity3d.com/hc/en-us">Knowledge Base</a><a href="http://forum.unity3d.com">Forums</a><a href="http://unity3d.com/asset-store">Asset Store</a>
</div>
</div>
<div></div>
</div>
</div></div></div>
</div>
</body>
</html>
