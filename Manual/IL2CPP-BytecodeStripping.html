<!DOCTYPE html><html class="no-js">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-5V25JL6');
    </script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="twitter:card" content="summary">
<meta name="robots" content="noindex">
<meta property="og:title" content="使用 IL2CPP 进行托管字节码剥离 - Unity Manual">
<title>使用 IL2CPP 进行托管字节码剥离 - Unity Manual</title>
<meta name="description" content="Managed byte code stripping is always enabled when the IL2CPP scripting backend is used. In this case, the Stripping Level option is replaced with an Boolean option named Strip Engine Code. If this option is enabled, unused modules and classes in the Unity Engine code will be removed. If it is disabled, all of the modules and classes in the Unity Engine code will be preserved.">
<meta property="og:description" content="Managed byte code stripping is always enabled when the IL2CPP scripting backend is used. In this case, the Stripping Level option is replaced with an Boolean option named Strip Engine Code. If this option is enabled, unused modules and classes in the Unity Engine code will be removed. If it is disabled, all of the modules and classes in the Unity Engine code will be preserved.">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="../StaticFiles/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFiles/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png">
<script>
      var docs_type = 'Manual';
      var lang = 'zh_CN';
      var page = 'IL2CPP-BytecodeStripping';
      if(!page) page = 'index';
      var version = '560';
      var docs_versions = [{version: '2019.1',version_string: '2019.1'},{version: '2018.4',version_string: '2018.4'},{version: '2018.3',version_string: '2018.3'},{version: '2018.2',version_string: '2018.2'},{version: '2018.1',version_string: '2018.1'},{version: '2017.4',version_string: '2017.4'},{version: '2017.3',version_string: '2017.3'},{version: '2017.2',version_string: '2017.2'},{version: '2017.1',version_string: '2017.1'},{version: '5.6',version_string: '560'},];</script><script type="text/javascript" src="../StaticFiles/js/jquery.js"></script><script type="text/javascript" src="../StaticFiles/js/core.js"></script><script type="text/javascript" src="../StaticFiles/js/jquery.sidebar.min.js"></script><script type="text/javascript" src="docdata/toc.js"></script><script type="text/javascript" src=""></script><script type="text/javascript" src="../StaticFiles/js/custom.js"></script><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,400italic" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/custom.css">
</head>
<body>
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="http://docs.unity3d.com"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="Search manual..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul class="menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">Manual</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">Scripting API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity3d.com/">
                unity3d.com
              </a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>5.6</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;"><ul>
<li><a class="docs_version_url_2019.1" href="/zh_CN/2019.1/Manual/IL2CPP-BytecodeStripping.html">2019.1</a></li>
<li><a class="docs_version_url_2018.4" href="/zh_CN/2018.4/Manual/IL2CPP-BytecodeStripping.html">2018.4</a></li>
<li><a class="docs_version_url_2018.3" href="/zh_CN/2018.3/Manual/IL2CPP-BytecodeStripping.html">2018.3</a></li>
<li><a class="docs_version_url_2018.2" href="/zh_CN/2018.2/Manual/IL2CPP-BytecodeStripping.html">2018.2</a></li>
<li><a class="docs_version_url_2018.1" href="/zh_CN/2018.1/Manual/IL2CPP-BytecodeStripping.html">2018.1</a></li>
<li><a class="docs_version_url_2017.4" href="/zh_CN/2017.4/Manual/IL2CPP-BytecodeStripping.html">2017.4</a></li>
<li><a class="docs_version_url_2017.3" href="/zh_CN/2017.3/Manual/IL2CPP-BytecodeStripping.html">2017.3</a></li>
<li><a class="docs_version_url_2017.2" href="/zh_CN/2017.2/Manual/IL2CPP-BytecodeStripping.html">2017.2</a></li>
<li><a class="docs_version_url_2017.1" href="/zh_CN/2017.1/Manual/IL2CPP-BytecodeStripping.html">2017.1</a></li>
<li><a class="docs_version_url_560" href="/zh_CN/560/Manual/IL2CPP-BytecodeStripping.html">5.6</a></li>
</ul></div>
</div>
<ul class="nav-menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">Manual</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">Scripting API</a></li>
</ul>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">Language:
        <span class="b">中文</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a data-lang="en" href="/560/Documentation/Manual/IL2CPP-BytecodeStripping.html">English</a></li>
<li><a data-lang="ja" href="/ja/560/Manual/IL2CPP-BytecodeStripping.html">日本語</a></li>
<li><a data-lang="es" href="/es/560/Manual/IL2CPP-BytecodeStripping.html">Español</a></li>
<li><a data-lang="kr" href="/kr/560/Manual/IL2CPP-BytecodeStripping.html">한국어</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar hidden"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc">
<h2>Manual</h2>
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>5.6</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;"><ul>
<li><a class="docs_version_url_2019.1" href="/zh_CN/2019.1/Manual/IL2CPP-BytecodeStripping.html">2019.1</a></li>
<li><a class="docs_version_url_2018.4" href="/zh_CN/2018.4/Manual/IL2CPP-BytecodeStripping.html">2018.4</a></li>
<li><a class="docs_version_url_2018.3" href="/zh_CN/2018.3/Manual/IL2CPP-BytecodeStripping.html">2018.3</a></li>
<li><a class="docs_version_url_2018.2" href="/zh_CN/2018.2/Manual/IL2CPP-BytecodeStripping.html">2018.2</a></li>
<li><a class="docs_version_url_2018.1" href="/zh_CN/2018.1/Manual/IL2CPP-BytecodeStripping.html">2018.1</a></li>
<li><a class="docs_version_url_2017.4" href="/zh_CN/2017.4/Manual/IL2CPP-BytecodeStripping.html">2017.4</a></li>
<li><a class="docs_version_url_2017.3" href="/zh_CN/2017.3/Manual/IL2CPP-BytecodeStripping.html">2017.3</a></li>
<li><a class="docs_version_url_2017.2" href="/zh_CN/2017.2/Manual/IL2CPP-BytecodeStripping.html">2017.2</a></li>
<li><a class="docs_version_url_2017.1" href="/zh_CN/2017.1/Manual/IL2CPP-BytecodeStripping.html">2017.1</a></li>
<li><a class="docs_version_url_560" href="/zh_CN/560/Manual/IL2CPP-BytecodeStripping.html">5.6</a></li>
</ul></div>
</div>
<div class="clear"></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap opened-sidebar"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity User Manual (5.6)</a></li>
<li><a href="ScriptingSection.html">脚本</a></li>
<li><a href="ScriptingTools.html">脚本工具</a></li>
<li><a href="IL2CPP.html">IL2CPP</a></li>
<li>使用 IL2CPP 进行托管字节码剥离</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="IL2CPP-OptimizingBuildTimes.html"></a></span><div class="tip">优化 IL2CPP 构建时间</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="EventSystem.html"></a></span><div class="tip">事件系统</div>
</div>
</div></div>
<h1>使用 IL2CPP 进行托管字节码剥离</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>Managed byte code stripping is always enabled when the <a href="IL2CPP.html">IL2CPP</a> scripting backend is used. In this case, the Stripping Level option is replaced with an Boolean option named Strip Engine Code. If this option is enabled, unused modules and classes in the Unity Engine code will be removed. If it is disabled, all of the modules and classes in the Unity Engine code will be preserved.</p>

<p>The link.xml file (described below) can be used to effectively disable bytecode stripping by preserving both types and full assemblies. For example, to prevent the System assembly from being stripped, the following link.xml file can be used:</p>

<pre><code>&lt;linker&gt;
       &lt;assembly fullname="System" preserve="all"/&gt;
&lt;/linker&gt;
</code></pre>

<h2>提示</h2>

<h3>使用反射时如何处理剥离</h3>

<p>剥离在很大程度上取决于静态代码分析，有时无法有效完成，尤其是在使用反射等动态特性时。在这种情况下，有必要提供一些关于不应触及哪些类的提示。Unity 支持每个项目的自定义剥离黑名单。使用黑名单很简单，只需创建一个 link.xml 文件并将其放入 Assets 文件夹（或 Assets 的任何子目录）即可。下面提供了 link.xml 文件内容的示例。标记为保留状态的类不受剥离的影响：</p>

<pre><code>&lt;linker&gt;
       &lt;assembly fullname="System.Web.Services"&gt;
               &lt;type fullname="System.Web.Services.Protocols.SoapTypeStubInfo" preserve="all"/&gt;
               &lt;type fullname="System.Web.Services.Configuration.WebServicesConfigurationSectionHandler" preserve="all"/&gt;
       &lt;/assembly&gt;

       &lt;assembly fullname="System"&gt;
               &lt;type fullname="System.Net.Configuration.WebRequestModuleHandler" preserve="all"/&gt;
               &lt;type fullname="System.Net.HttpRequestCreator" preserve="all"/&gt;
               &lt;type fullname="System.Net.FileWebRequestCreator" preserve="all"/&gt;
       &lt;/assembly&gt;

       &lt;assembly fullname="mscorlib"&gt;
               &lt;type fullname="System.AppDomain" preserve="fields"/&gt;
               &lt;type fullname="System.InvalidOperationException" preserve="fields"&gt;
                       &lt;method signature="System.Void .ctor()"/&gt;
               &lt;/type&gt;
               &lt;type fullname="System.Object" preserve="nothing"&gt;
                      &lt;method name="Finalize"/&gt;
               &lt;/type&gt;
       &lt;/assembly&gt;
&lt;/linker&gt;
</code></pre>

<p>一个项目可以包含多个 link.xml 文件。每个 link.xml 文件可指定许多不同的选项。
assembly 元素指示应该应用嵌套指令的托管程序集。</p>

<p>type 元素用于指示应如何处理特定类型。它必须是 assembly 元素的子元素。fullname 属性可接受“*”通配符匹配一个或多个字符。</p>

<p>preserve 属性可以采用以下三个值之一：</p>

<ul>
<li>all: Keep everything from the given type (or assembly, for IL2CPP only).</li>
<li>fields: Keep only the fields of the given type.</li>
<li>nothing: Keep only the given type, bug none of its contents.</li>
</ul>

<p>method 元素用于指示应保留特定方法。它必须是 type 元素的子元素。可按名称或签名来指定方法。</p>

<p>剥离的程序集将输出到项目中 Temp 目录下的目录（具体位置因目标平台而异）。原始的未剥离程序集在未剥离的目录中与剥离的程序集位于相同的位置。可使用 ILSpy 之类的工具来检查剥离的和未剥离的程序集，从而确定删除了代码的哪些部分。</p>

<hr>

<ul>
<li><p><span class="page-edit">2017–05–26 Page published with limited <a href="DocumentationEditorialReview.html">editorial review</a> - <a href="LeaveFeedback.html">Leave page feedback</a></span></p></li>
<li><p><span class="page-history">2017–05–26 - Unity 5.6 用户手册中进行了仅限于文档的更新</span></p></li>
</ul>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="IL2CPP-OptimizingBuildTimes.html"></a></span><div class="tip">优化 IL2CPP 构建时间</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="EventSystem.html"></a></span><div class="tip">事件系统</div>
</div>
</div>
</div>
<div class="footer-wrapper">
<div class="footer clear">
<div class="copy">Copyright © 2017 Unity Technologies. Publication 5.6</div>
<div class="menu">
<a href="http://unity3d.com/learn">Tutorials</a><a href="http://answers.unity3d.com">Community Answers</a><a href="https://support.unity3d.com/hc/en-us">Knowledge Base</a><a href="http://forum.unity3d.com">Forums</a><a href="http://unity3d.com/asset-store">Asset Store</a>
</div>
</div>
<div></div>
</div>
</div></div></div>
</div>
</body>
</html>
